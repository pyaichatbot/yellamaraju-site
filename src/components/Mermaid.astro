---
interface Props {
  chart: string;
}

const { chart } = Astro.props;
---

<div class="mermaid-wrapper">
  <pre class="mermaid">{chart}</pre>
</div>

<script is:inline>
  (function() {
    if (typeof window === 'undefined') return;
    
    if (!window.mermaidLoaded) {
      const script = document.createElement('script');
      script.type = 'module';
      script.textContent = `
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ 
          startOnLoad: true,
          theme: 'neutral',
          themeVariables: {
            primaryColor: '#2563eb',
            primaryTextColor: '#1a1a1a',
            primaryBorderColor: '#2563eb',
            lineColor: '#4a4a4a',
            secondaryColor: '#f5f5f5',
            tertiaryColor: '#fdfcfb'
          }
        });
        mermaid.run();
        window.mermaidLoaded = true;
      `;
      document.head.appendChild(script);
    } else {
      setTimeout(function() {
        var mermaid = window.mermaid;
        if (mermaid && typeof mermaid.run === 'function') {
          mermaid.run();
        }
      }, 100);
    }
  })();
</script>

<style>
  .mermaid-wrapper {
    margin: var(--space-lg) 0;
    padding: var(--space-md);
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: 8px;
    overflow-x: auto;
  }
  
  .mermaid {
    display: flex;
    justify-content: center;
    background: transparent;
    padding: 0;
    margin: 0;
  }
</style>
