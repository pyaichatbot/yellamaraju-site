---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PostCard from '../../components/PostCard.astro';
import TagBadge from '../../components/TagBadge.astro';
import SearchInput from '../../components/SearchInput.astro';
import { getCollection } from 'astro:content';
import { calculateReadingTime, sortPostsByDate, getUniqueTags } from '../../utils/helpers';

const allPosts = await getCollection('blog');
const sortedPosts = sortPostsByDate(allPosts);
const allTags = getUniqueTags(allPosts);
---

<BaseLayout title="Blog" description="Insights on AI/ML, agentic systems, prompt engineering, and building intelligent enterprise solutions.">
  <div class="blog-page">
    <div class="container">
      <div class="wide-wrapper">
        <header class="page-header">
          <h1>Blog</h1>
          <p class="page-description">
            Thoughts on building intelligent systems, AI architecture, and the future of enterprise technology.
          </p>
        </header>
        
        <div class="search-section">
          <SearchInput />
        </div>
        
        <div class="filters">
          <div class="filter-section">
            <h3>Filter by Topic</h3>
            <div class="tags-filter">
              <a href="/blog" class="tag-badge active">All</a>
              {allTags.map(tag => (
                <TagBadge tag={tag} />
              ))}
            </div>
          </div>
        </div>
        
        <div class="posts-list">
          {sortedPosts.map(post => (
            <PostCard
              title={post.data.title}
              description={post.data.description}
              date={post.data.date}
              tags={post.data.tags}
              slug={post.slug}
              readingTime={calculateReadingTime(post.body)}
            />
          ))}
        </div>
      </div>
    </div>
  </div>
</BaseLayout>

<style>
  .blog-page {
    padding: var(--space-lg) 0 var(--space-xl);
  }
  
  .page-header {
    text-align: center;
    margin-bottom: var(--space-xl);
    padding-bottom: var(--space-lg);
    border-bottom: 1px solid var(--color-border);
  }
  
  .page-header h1 {
    font-size: 3rem;
    margin-bottom: var(--space-xs);
  }
  
  .page-description {
    font-size: 1.25rem;
    color: var(--color-text-secondary);
    max-width: 600px;
    margin: 0 auto;
  }
  
  .search-section {
    margin-bottom: var(--space-lg);
    padding: 0 var(--space-md);
  }
  
  .filters {
    margin-bottom: var(--space-lg);
  }
  
  .filter-section h3 {
    font-size: 1rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-secondary);
    margin-bottom: var(--space-sm);
  }
  
  .tags-filter {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-sm);
  }

  .tags-filter .tag-badge {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    font-size: 0.8rem;
    font-weight: 500;
    color: var(--color-accent);
    background: var(--color-code-bg);
    border-radius: 4px;
    text-decoration: none;
    transition: all var(--transition-fast);
    border: 1px solid var(--color-border);
  }

  .tags-filter .tag-badge:hover {
    background: var(--color-surface);
    border-color: var(--color-accent);
    transform: translateY(-1px);
  }
  
  .tag-badge.active {
    background: var(--color-accent);
    color: white;
    border-color: var(--color-accent);
  }
  
  .posts-list {
    display: flex;
    flex-direction: column;
  }
  
  @media (max-width: 768px) {
    .page-header h1 {
      font-size: 2rem;
    }
    
    .page-description {
      font-size: 1.1rem;
    }
  }
</style>
