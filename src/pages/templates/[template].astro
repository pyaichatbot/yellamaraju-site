---
import { getTemplateBySlug } from '../../data/templates';

export async function getStaticPaths() {
  // Import templates dynamically to avoid circular dependencies
  const { templates } = await import('../../data/templates');

  return templates.map((template) => ({
    params: { template: template.slug }
  }));
}

const { template: templateSlug } = Astro.params;
const template = getTemplateBySlug(templateSlug || '');

// Redirect to new category-based URL structure for backward compatibility
if (template) {
  return Astro.redirect(`/templates/${template.category}/${template.slug}`, 301);
  }

// If template not found, redirect to templates index
return Astro.redirect('/templates', 301);
---
